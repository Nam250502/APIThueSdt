/*!
 * Start Bootstrap - SB Admin 2 v4.1.3 (https://startbootstrap.com/theme/sb-admin-2)
 * Copyright 2013-2021 Start Bootstrap
 * Licensed under MIT (https://github.com/StartBootstrap/startbootstrap-sb-admin-2/blob/master/LICENSE)
 */

    $(document).ready(function() {
        $('#myForm').on('submit', function(event) {
            event.preventDefault();

            var formData = $(this).serialize();

            $.ajax({
                type: 'POST',
                url: '/user/naptien',
                data: formData,
                success: function(response) {
                    if (response === 'success') {
                        $('#thongbao').text('Nạp tiền thành công!');
                    } else {
                        $('#thongbao').text('Nạp tiền thất bại. Vui lòng thử lại sau!');
                    }
                },
                error: function(xhr, status, error) {
                    $('#thongbao').text('Đã xảy ra lỗi: ' + error);
                }
            });
        });
    });


      $(document).ready(function() {
    $('.select2-select').select2();
  });

<!--  function sendData() {-->
<!--    var selectedId = document.getElementById("networkSelect").value;-->
<!--    window.location.href = "/service/useservice?id=" + selectedId;-->
<!--  }-->

var intervalId; // Biến để lưu trữ ID của interval

function sendData() {
  var selectedId = document.getElementById("networkSelect").value;

  $.ajax({
    url: "/rest/useservice",
    method: "GET",
    data: {
      id: selectedId
    },
    success: function(response) {
      var requestId = response.request_id;
      getCodeByRequestId(requestId);

      // Đặt interval chạy hàm getCodeByRequestId mỗi 10 giây
      intervalId = setInterval(function() {
        getCodeByRequestId(requestId);
      }, 10000);

      // Dừng interval sau 2 phút
      setTimeout(function() {
        clearInterval(intervalId);
        sendHoanTienRequest(selectedId);
      }, 120000);
    },
    error: function(xhr, status, error) {
      console.log(error);
    }
  });
}



function getCodeByRequestId(requestId) {
  $.ajax({
    url: "/rest/getcode/" + requestId,
    method: "GET",
    success: function(response) {
      // Cập nhật dữ liệu vào các ô dữ liệu tương ứng
      $("#id").text(response.ID);
      $("#serviceId").text(response.ServiceID);
      $("#serviceName").text(response.ServiceName);
      $("#price").text(response.Price);
      $("#smsContent").text(response.SmsContent);
      if(response.Status==0){
       $("#status").text("Đang Chờ Tin Nhắn");
      }
      if(response.Status==1){
       $("#status").text("Hoàn thành");
      }
      if(response.Status==2){
       $("#status").text("Hết Hạn");
      }
      $("#createdTime").text(new Date(response.CreatedTime).toLocaleString());
      $("#isSound").text(response.IsSound);
      $("#code").text(response.Code);
      $("#phoneOriginal").text(response.PhoneOriginal);
      $("#phone").text(response.Phone);
      $("#countryISO").text(response.CountryISO);
      $("#countryCode").text(response.CountryCode);
    },
    error: function(xhr, status, error) {
      console.log(error);
    }
  });
}
function sendHoanTienRequest(selectedId) {
  // Gửi request POST với dữ liệu từ selectedId đến URL "/hoantien"
  $.ajax({
    url: "/rest/hoantien",
    method: "POST",
    data: {
      id: selectedId
    },
    success: function(response) {
      // Xử lý response từ phương thức hoanUserBalance
    },
    error: function(xhr, status, error) {
      console.log(error);
    }
  });
}


  $(document).ready(function() {
    $('#searchButton').click(function() {
      var searchText = $('#searchInput').val().toLowerCase();
      searchTable(searchText);
    });
  });

  function searchTable(searchText) {
  $('table tbody tr').each(function() {
    var row = $(this);
    var serviceName = row.find('#serviceName').text().toLowerCase();
    var price = row.find('#price').text().toLowerCase();
    var phone = row.find('#phone').text().toLowerCase();
    var code = row.find('#code').text().toLowerCase();
    var createdTime = row.find('#createdTime').text().toLowerCase();
    var status = row.find('#status').text().toLowerCase();

    if (serviceName.includes(searchText) || price.includes(searchText) || phone.includes(searchText) || code.includes(searchText) || createdTime.includes(searchText) || status.includes(searchText)) {
      row.show();
    } else {
      row.hide();
    }
  });
}


!function(l){"use strict";l("#sidebarToggle, #sidebarToggleTop").on("click",function(e){l("body").toggleClass("sidebar-toggled"),l(".sidebar").toggleClass("toggled"),l(".sidebar").hasClass("toggled")&&l(".sidebar .collapse").collapse("hide")}),l(window).resize(function(){l(window).width()<768&&l(".sidebar .collapse").collapse("hide"),l(window).width()<480&&!l(".sidebar").hasClass("toggled")&&(l("body").addClass("sidebar-toggled"),l(".sidebar").addClass("toggled"),l(".sidebar .collapse").collapse("hide"))}),l("body.fixed-nav .sidebar").on("mousewheel DOMMouseScroll wheel",function(e){var o;768<l(window).width()&&(o=(o=e.originalEvent).wheelDelta||-o.detail,this.scrollTop+=30*(o<0?1:-1),e.preventDefault())}),l(document).on("scroll",function(){100<l(this).scrollTop()?l(".scroll-to-top").fadeIn():l(".scroll-to-top").fadeOut()}),l(document).on("click","a.scroll-to-top",function(e){var o=l(this);l("html, body").stop().animate({scrollTop:l(o.attr("href")).offset().top},1e3,"easeInOutExpo"),e.preventDefault()})}(jQuery);